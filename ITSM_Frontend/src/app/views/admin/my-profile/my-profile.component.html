<div class="main-container fade-in">
  <!-- Edit Button -->
  <button class="edit-user-button" (click)="openDialogue(userId)">
    <i class="pi pi-pencil"></i> Edit User
  </button>

  <p-card class="profile-card glass-effect"  aria-hidden="true">
    <div class="profile-pic-container">
      <img
        [src]="getProfileImageUrl()"
        alt="Profile Picture"
        class="profile-pic"
      />
      <div class="edit-button-container">
        <input
          type="file"
          #fileInput
          accept="image/*"
          (change)="handleUpload($event)"
          style="display: none"
        />
        <button
          class="edit-button"
          (click)="fileInput.click()"
          pTooltip="Edit Profile Pic"
        >
          <i class="pi pi-camera"></i>
        </button>
      </div>
    </div>

    <div class="user-name-container">
      <h2>{{ capitalizeWords() }}</h2>
      <p class="user-id">{{ user.email }}</p>
    </div>

    <div class="user-info">
      <div class="p-field">
        <label>Mobile Number:</label>
        <p>{{ user.mobileNumber }}</p>
      </div>
      <div class="p-field">
        <label>Designation:</label>
        <p>{{ this.role }}</p>
      </div>
    </div>
  </p-card>
</div>

<!-- Edit and add user management dialog -->
<p-dialog
  [(visible)]="userDialouge"
  [style]="{ width: '80%', maxWidth: '900px' }"
  [closable]="false"
  [modal]="true"
  class="p-fluid"
  appendTo="body"
>
  <p-header class="font-medium">New User</p-header>

  <ng-template pTemplate="content">
    <div class="formgrid grid mt-2">
      <form [formGroup]="userForm" class="grid gap-2">
        <!-- Name Fields Group -->
        <div class="col-12 md:col-12 lg:col-12">
          <p-fieldset legend="User Information" [toggleable]="true">
            <div class="grid">
              <div class="col-12 md:col-4 my-3 p-float-label">
                <input pInputText id="firstName" formControlName="firstName" />
                <label for="firstName"
                  >First Name <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('firstName')?.touched &&
                    userForm.get('firstName')?.hasError('required')
                  "
                  class="p-error"
                  >First Name is required.</small
                >
                <small
                  *ngIf="
                    userForm.get('firstName')?.touched &&
                    userForm.get('firstName')?.hasError('minlength')
                  "
                  class="p-error"
                  >First Name must be at least 2 characters long.</small
                >
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label">
                <input
                  pInputText
                  id="middleName"
                  formControlName="middleName"
                />
                <label for="middleName">Middle Name</label>
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label">
                <input pInputText id="lastName" formControlName="lastName" />
                <label for="lastName"
                  >Last Name <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('lastName')?.touched &&
                    userForm.get('lastName')?.hasError('required')
                  "
                  class="p-error"
                  >Last Name is required.</small
                >
                <small
                  *ngIf="
                    userForm.get('lastName')?.touched &&
                    userForm.get('lastName')?.hasError('minlength')
                  "
                  class="p-error"
                  >Last Name must be at least 2 characters long.</small
                >
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label">
                <input
                  pInputText
                  id="description"
                  formControlName="description"
                />
                <label for="description"
                  >Description <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('description')?.touched &&
                    userForm.get('description')?.hasError('required')
                  "
                  class="p-error"
                  >Description is required.</small
                >
              </div>
            </div>
          </p-fieldset>
        </div>

        <!-- Contact Information Group -->
        <div class="col-12 md:col-12 lg:col-12">
          <p-fieldset legend="Contact Information" [toggleable]="true">
            <div class="grid">
              <div class="col-12 md:col-4 my-3 p-float-label">
                <input pInputText id="emailId" formControlName="email" />
                <label for="emailId"
                  >Email ID <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('email')?.touched &&
                    userForm.get('email')?.hasError('required')
                  "
                  class="p-error"
                  >Email is required.</small
                >
                <small
                  *ngIf="
                    userForm.get('email')?.touched &&
                    userForm.get('email')?.hasError('email')
                  "
                  class="p-error"
                  >Enter a valid email address.</small
                >
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label">
                <input
                  pInputText
                  id="mobileNumber"
                  formControlName="mobileNumber"
                />
                <label for="mobileNumber"
                  >Mobile Number <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('mobileNumber')?.touched &&
                    userForm.get('mobileNumber')?.hasError('required')
                  "
                  class="p-error"
                  >Mobile number is required.</small
                >
                <small
                  *ngIf="
                    userForm.get('mobileNumber')?.touched &&
                    userForm.get('mobileNumber')?.hasError('pattern')
                  "
                  class="p-error"
                  >Enter a valid 10-digit mobile number.</small
                >
              </div>
            </div>
          </p-fieldset>
        </div>

        <!-- Account Information Group -->
        <div class="col-12 md:col-12 lg:col-12">
          <p-fieldset legend="Account Information" [toggleable]="true">
            <div class="grid">
              <div class="col-12 md:col-4 my-3 p-float-label">
                <input pInputText id="username" formControlName="userName" />
                <label for="username"
                  >Username <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('userName')?.touched &&
                    userForm.get('userName')?.hasError('required')
                  "
                  class="p-error"
                  >Username is required.</small
                >
                <small
                  *ngIf="
                    userForm.get('userName')?.touched &&
                    userForm.get('userName')?.hasError('minlength')
                  "
                  class="p-error"
                  >Username must be at least 4 characters long.</small
                >
              </div>

              <div
                class="col-12 md:col-4 my-3 p-float-label"
                *ngIf="!editUserId"
              >
                <input
                  pInputText
                  id="password"
                  formControlName="password"
                  type="password"
                />
                <label for="password"
                  >Password <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('password')?.touched &&
                    userForm.get('password')?.hasError('required')
                  "
                  class="p-error"
                  >Password is required.</small
                >
                <small
                  *ngIf="
                    userForm.get('password')?.touched &&
                    userForm.get('password')?.hasError('minlength')
                  "
                  class="p-error"
                  >Password must be at least 6 characters long.</small
                >
              </div>
            </div>
          </p-fieldset>
        </div>

        <!-- Role & Group Information -->
        <div class="col-12 md:col-12 lg:col-12">
          <p-fieldset legend="Role & Group Information" [toggleable]="true">
            <div class="grid">
              <div class="col-12 md:col-4 my-3 p-float-label">
                <p-dropdown
                  [options]="supportGroups"
                  formControlName="supportGroup"
                  optionLabel="support_group_name"
                  placeholder="Select a Support Group"
                  optionValue="support_group_id"
                  appendTo="body"
                ></p-dropdown>
                <label for="supportGroup">Support Group</label>
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label">
                <p-dropdown
                  [options]="userRoles"
                  formControlName="userRole"
                  optionValue="role_id"
                  optionLabel="role_name"
                  placeholder="Select a User Role"
                  appendTo="body"
                ></p-dropdown>
                <label for="userRole"
                  >User Role <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('userRole')?.touched &&
                    userForm.get('userRole')?.hasError('required')
                  "
                  class="p-error"
                  >Support Group is required.</small
                >
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label">
                <p-dropdown
                  [options]="levels"
                  formControlName="level"
                  optionValue="level_id"
                  optionLabel="level_name"
                  placeholder="Select a Level"
                  appendTo="body"
                ></p-dropdown>
                <label for="level">Level</label>
              </div>
            </div>
          </p-fieldset>
        </div>

        <!-- Other Information Group -->
        <div class="col-12 md:col-12 lg:col-12">
          <p-fieldset legend="Additional Information" [toggleable]="true">
            <div class="grid">
              <div class="col-12 md:col-4 my-3 p-float-label">
                <p-dropdown
                  [options]="genders"
                  formControlName="genderId"
                  optionValue="id"
                  optionLabel="gender_name"
                  placeholder="Select Gender"
                  appendTo="body"
                ></p-dropdown>
                <label for="gender"
                  >Gender <span class="required-asterisk">*</span></label
                >
                <small
                  *ngIf="
                    userForm.get('genderId')?.touched &&
                    userForm.get('genderId')?.hasError('required')
                  "
                  class="p-error"
                  >Support Group is required.</small
                >
              </div>

              <div class="col-12 md:col-4 my-3 p-float-label" *ngIf="reportingtoshow">
                <p-dropdown
                  [options]="reportingTo"
                  formControlName="reportingTo"
                  optionValue="user_id"
                  optionLabel="full_name"
                  placeholder="Select Reporting To"
                  appendTo="body"
                ></p-dropdown>
                <label for="reportingTo">Select Reporting To</label>
              </div>
            </div>
          </p-fieldset>
        </div>
      </form>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <p-button
      class="mr-4"
      icon="pi pi-times"
      label="Cancel"
      size="small"
      severity="secondary"
      (click)="userDialouge = false"
    ></p-button>
    <p-button
      icon="pi pi-check"
      label="Update"
      size="small"
      severity="primary"
      (click)="onUpdate()"
    ></p-button>
  </ng-template>
</p-dialog>
